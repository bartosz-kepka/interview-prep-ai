---
import Layout from '../layouts/Layout.astro';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '../components/ui/card';
import { ResetPasswordForm } from '../components/auth/ResetPasswordForm';

export const prerender = false;
// Get the code from URL params
const url = Astro.url;
const code = url.searchParams.get('code');
const error = url.searchParams.get('error');
const errorDescription = url.searchParams.get('error_description');

// Handle errors from Supabase (e.g., expired link)
if (error) {
  if (error === 'access_denied' && errorDescription?.includes('expired')) {
    return Astro.redirect('/error/expired-link');
  }
  // Redirect to login with error message
  return Astro.redirect(`/login?error=${encodeURIComponent(errorDescription || 'Authentication failed')}`);
}

// No code - redirect to login
if (!code) {
  return Astro.redirect('/login');
}

---

<Layout title="Reset Password - Interview Prep AI">
  <main class="container mx-auto px-4 py-8 min-h-screen flex items-center justify-center">
    <div class="w-full max-w-md">
      <Card>
        <CardHeader>
          <CardTitle>Set new password</CardTitle>
          <CardDescription>Enter your new password below</CardDescription>
        </CardHeader>
        <CardContent>
          <ResetPasswordForm client:load code={code} />
        </CardContent>
      </Card>
    </div>
  </main>
</Layout>
